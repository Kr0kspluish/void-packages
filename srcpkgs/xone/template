# Template file for 'xone'
pkgname=xone
version=0.4.5
revision=1
depends="curl cabextract dkms"
short_desc="Modern Linux driver for Xbox One and Xbox Series X|S controllers"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-only"
homepage="https://github.com/dlundqvist/xone"
distfiles="https://github.com/dlundqvist/xone/archive/refs/tags/v${version}.tar.gz"
checksum="74b2a83d338d5c35737bffa338b7aab28e85a88fe947e1594b52edd15aa0a7a2"

dkms_modules="${pkgname} ${version}"

do_install() {
	vinstall install/modprobe.conf 644 /usr/lib/modprobe.d xone.conf
	vbin install/firmware.sh xone-update-firmware
	vdoc "${FILESDIR}/README.voidlinux"
	find . -type f \( -name dkms.conf -o -name '*.c' \) -exec sed -i "s/#VERSION#/$version/" {} +
	vmkdir /usr/src/${pkgname}-${version}
	for file in auth bus driver transport Kbuild dkms.conf; do
		vcopy $file /usr/src/${pkgname}-${version}/
	done
}
